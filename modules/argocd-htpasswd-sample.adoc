// Module included in the following assemblies:
//
// * scalability_and_performance/using-argocd.adoc

[id="argocd-htpasswd-sample_{context}"]
= HTPasswd OAuth provider

You can use ArgoCD to deploy an HTPasswd OAuth provider. The following sample defines and ArgoCD application that you can use to log in to your cluster as the `user1` user with the password `MyPassword!`.

.ArgoCD HTPassword OAuth provider sample (`oauth-htpasswd.yaml`)
----
---
apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
  annotations:
    argocd.argoproj.io/sync-options: Prune=false
spec:
  identityProviders:
  - name: my_identity_provider
    mappingMethod: claim
    type: HTPasswd
    htpasswd:
      fileData:
        name: htpass-secret
----

.Secret for the HTPassword OAuth provider sample (`htpass-secret.yaml`)
----
---
apiVersion: v1
data:
  htpasswd: dXNlcjE6JDJ5JDA1JFBqUWVqZ1VNMzU5LnJkOE5xQzlweXVHbk9JM3JrVWl4cWh2NDg4enJVNVJvaEhZa2dLWGFhCg==
kind: Secret
metadata:
  name: htpass-secret
  namespace: openshift-config
  annotations:
    argocd.argoproj.io/sync-options: Prune=false
    argocd.argoproj.io/compare-options: IgnoreExtraneous
type: Opaque
----

These sample global OAuth config resource and a namespaced secret files are in the `./identity-providers` directory of the ArgoCD samples repository.

// For information on how this secret was created, see the [OpenShift 4 Documentation](https://docs.openshift.com/container-platform/4.1/authentication/identity_providers/configuring-htpasswd-identity-provider.html#configuring-htpasswd-identity-provider).

. Create the `htpasswd-oauth` application in ArgoCD:
+
----
$ argocd app create htpasswd-oauth --repo https://github.com/<account_name>/openshift4-gitops.git --path=identity-providers --dest-server=https://kubernetes.default.svc --dest-namespace=openshift-config <1>
$ argocd app sync htpasswd-oauth
----
<1> `<account_name>` is the name of the GitHub account or organization that you cloned the repository to.

[WARNING]
====
The `openshift-oauth` Operator copies your secrets to the `openshift-authentication` Operator, including their labels. One of these labels is added by ArgoCD to indicate the secret is owned by the `htpasswd-oauth` application. When this label is copied, ArgoCD recognizes that the secret is owned by the application but attempts to prune it because ArgoCD did not create the secret. Because the application configuration contains the annotation that prevents it from pruning the resource, it will not be deleted, but the secret will show as out of sync in the ArgoCD console.
====
