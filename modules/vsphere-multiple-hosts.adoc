// Module included in the following assemblies:
//
// * installing/installing_vsphere/vsphere-hosts.adoc

[id="vsphere-multiple-hosts_{context}"]
= Configuring multiple vSphere hosts

You can configure your cluster to run on multiple VMware vSphere hosts.

.Prerequisites

* You installed a {product-title} cluster on vSphere.
* You reviewed the
link:https://vmware.github.io/vsphere-storage-for-kubernetes/documentation/existing.html[vSphere Cloud Provider Configuration]
and can provide the data that is required for the `VirtualCenter` hosts that you
add.
* The vSphere hosts that you add have access to shared storage. See the
link:https://vmware.github.io/vsphere-storage-for-kubernetes/documentation/faqs.html#can-kubernetes-cluster-span-across-multiple-vcenters[vSphere Storage for Kubernetes FAQ]
in the VMware documentation.

.Procedure

. Edit the `cloud-provider-config` ConfigMap:
+
----
$ oc edit configmap/cloud-provider-config -n openshift-config
----
+
----
apiVersion: v1
data:
  config: |+
    [Global]
    secret-name      = vsphere-creds
    secret-namespace = kube-system
    insecure-flag    = 1
    datacenter       = datacenter <1>

    [Workspace]
    server            = server.example.com
    datacenter        = dc1
    default-datastore = nvme-ds1
    folder            = blah

    [VirtualCenter "server.example.com"] <2>
    datacenters = dc1

kind: ConfigMap
metadata:
  creationTimestamp: null
  name: cloud-provider-config
  namespace: openshift-config
----
<1> Specify the name of the datacenter that you used when you installed {product-title}.
<2> Add more `[VirtualCenter]` sections to define the additional hosts for your
cluster. See the
link:https://vmware.github.io/vsphere-storage-for-kubernetes/documentation/existing.html[vSphere Cloud Provider Configuration]
page in the VMware documentation.

. Ensure that all of the cluster Operators are available:
+
----
$ watch -n5 oc get clusteroperators

NAME                                 VERSION   AVAILABLE   PROGRESSING   DEGRADED   SINCE
authentication                       4.1.0     True        False         False      17h
cloud-credential                     4.1.0     True        False         False      18h
cluster-autoscaler                   4.1.0     True        False         False      18h
console                              4.1.0     True        False         False      17h
dns                                  4.1.0     True        False         False      18h
image-registry                       4.1.0     True        False         False      17h
ingress                              4.1.0     True        False         False      17h
kube-apiserver                       4.1.0     True        False         False      5m
kube-controller-manager              4.1.0     True        False         False      4m
kube-scheduler                       4.1.0     True        False         False      18h
machine-api                          4.1.0     True        False         False      18h
machine-config                       4.1.0     True        False         False      18h
marketplace                          4.1.0     True        False         False      17h
monitoring                           4.1.0     True        False         False      17h
network                              4.1.0     True        False         False      18h
node-tuning                          4.1.0     True        False         False      18h
openshift-apiserver                  4.1.0     True        False         False      18h
openshift-controller-manager         4.1.0     True        False         False      18h
openshift-samples                    4.1.0     True        False         False      17h
operator-lifecycle-manager           4.1.0     True        False         False      18h
operator-lifecycle-manager-catalog   4.1.0     True        False         False      18h
service-ca                           4.1.0     True        False         False      18h
service-catalog-apiserver            4.1.0     True        False         False      18h
service-catalog-controller-manager   4.1.0     True        False         False      18h
storage                              4.1.0     True        False         False      17h
----
+
When all of the Operators are available, you can access the new vSphere hosts
that you added.
