// Module included in the following assemblies:
//
// * installing/installing_aws/uninstalling-cluster-aws.adoc

[id="installation-uninstall-aws_{context}"]
= Removing a cluster from AWS

You can remove a cluster that you installed on Amazon Web Services (AWS).

.Prerequisites

* Have a copy of the installation program that you used to deploy the cluster.

.Procedure

Perform the following steps on the computer that you used to install the cluster.

. Locate the `metadata.json` file that describes your cluster. This file is in
the `installation_directory` directory that you specified when you deployed your
cluster.

. If you cannot locate the `metadata.json` file, recreate it:

.. If you still have the `installation_directory` directory, change to that
directory.

.. Obtain the cluster infrastructure ID. You need the AWS region the cluster
was deployed to and the cluster ID to use AWS CLI to obtain infrastructure ID
from the `kubernetes.io/cluster` tag:
+
[NOTE]
====
If you did not install the AWS CLI when you deployed your cluster, see
link:https://docs.aws.amazon.com/cli/latest/userguide/install-bundle.html[Install the AWS CLI Using the Bundled Installer (Linux, macOS, or Unix)]
in the AWS documentation.
====
+
----
$ aws --region <aws_region> ec2 describe-vpcs | jq -c '.Vpcs[] | .Tags | select(. != null) | from_entries | ."name" = (keys[] | select(. | startswith("kubernetes.io/cluster/")) | sub("^kubernetes.io/cluster/"; "")) | .name | select(. | startswith("<cluster_name>"))' <1>

"<cluster_name>-j4slw"
----
<1> In this command, `<aws_region>` is the AWS region the cluster was deployed
in, and `<cluster_name>` is the cluster's name.
+
The command output is the infrastructure ID for your cluster..

.. Store the cluster name, AWS region, and infrastructure ID as environment variables:
+
----
$ AWS_REGION=<aws_region> <1>
$ INFRA_ID=<infrastructure_ID> <2>
----
<1> `<aws_region>` is the AWS region the cluster was deployed in.
<2> `<infrastructure_ID>` is the cluster's infrastructure_ID that you obtained.

.. Generate the `metadata.json` file for your cluster:
+
----
$ echo "{\"aws\":{\"region\":\"${AWS_REGION}\",\"identifier\":[{\"kubernetes.io/cluster/${INFRA_ID}\":\"owned\"}]}}" > metadata.json
----

. Change to the directory that contains the {product-title} installation program
and run the following command:
+
----
$ ./openshift-install destroy cluster \
--dir=<metadata_directory> --log-level=debug <1>
----
<1> For `<installation_directory>`, specify the path to the directory that you
stored the installation files in.
+
[NOTE]
====
You must specify the directory that contains the cluster definition files for
your cluster. The installation program requires the `metadata.json` file in this
directory to delete the cluster.
====

. Optional: Delete the `<installation_directory>` directory and the
{product-title} installation program.
