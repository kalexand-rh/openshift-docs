// Module included in the following assemblies:
//
// *

[id="migrating-azure-dns-zones_{context}"]
= Migrating legacy Azure DNS zones

If you installed an {product-title} version 4.2 or 4.3 cluster on Azure that uses installer-provisioned infrastructure, you must migrate the legacy private DNS zone to the new type of private DNS zone.

For more information about private zones in Azure, see link:https://azure.microsoft.com/en-us/updates/announcing-preview-refresh-for-azure-dns-private-zones-2/[Announcing Preview Refresh for Azure DNS Private Zones].

.Prerequisites

* Obtain the {product-title} installation program.

.Procedure

. Determine your legacy zones:
+
----
$ ./openshift-install migrate azure privatedns eligible

INFO[0000] Credentials loaded from file "<path_to>/ServicePrincipal.json"
INFO[0002] legacy zone=<legacy_zone> resourceGroup=<resource_group_name>
----
+
Note the names of the legacy zones.

. Migrate a legacy zone:
+
----
$ openshift-install migrate azure privatedns migrate \
  --old-resource-group=<resource_group> \ <1>
  --new-resource-group=<new_resource_group> \ <2>
  --zone=example.com \ <3>
  --virtual-network=<vnet> \ <4>
  --virtual-network-resource-group=<resource_group>  \ <5>
  --link <6>
----
<1> Optional: Specify the resource group for the legacy zone, as shown in the output of the previous command.
<2> For `<new_resource_group>`, specify the resource group to create the private zone in. This resource group does not have to be the same resource group that hosts your cluster but must be the resource group that hosts your current DNS zone.
<3> Specify the private DNS zone to migrate.
<4> Optional: Specify the virtual network to create the private zone in.
<5> If you specify a virtual network, you must specify the resource group that contains it. If you do not specify a virtual network, you do not have to define this parameter.
<6> To link the new private zone to the virtual network for DNS, include `--link`. If you do not include this option, a virtual network link from the new zone to the vNet is not created.

. Repeat the previous step for each remaining legacy zone.
