// Module included in the following assemblies:
//
// *

[id="migrating-azure-dns-zones_{context}"]
= Migrating legacy Azure DNS zones

If you use a legacy private DNS zone in an {product-title} version 4.2 or 4.3 cluster on Azure that uses installer-provisioned infrastructure, you must migrate to the new type of private DNS zone before you upgrade.

For more information about private zones in Azure, see link:https://azure.microsoft.com/en-us/updates/announcing-preview-refresh-for-azure-dns-private-zones-2/[Announcing Preview Refresh for Azure DNS Private Zones].

.Prerequisites

* Obtain the {product-title} installation program.

.Procedure

. Determine your legacy zones:
+
----
$ ./openshift-install migrate azure-privatedns-eligible

INFO Credentials loaded from file "<path_to>/ServicePrincipal.json"
INFO legacy zone=<legacy_zone> resourceGroup=<resource_group_name>
----
+
Note the names of the legacy zones.
+
[IMPORTANT]
====
If no legacy zones display, your cluster does not use a legacy zone. No further action is required.
====

. Migrate a legacy zone:
+
----
$ ./openshift-install migrate azure-privatedns \
  --resource-group=<resource_group> \ <1>
  --zone=example.com \ <2>
  --virtual-network=<vnet> \ <3>
  --virtual-network-resource-group=<resource_group>  \ <4>
  --link <5>
----
<1> Specify the resource group for the legacy zone, as shown in the output of the previous command.
<2> Specify the private DNS zone to migrate.
<3> Optional: Specify the virtual network to create the private zone in.
<4> If you specify a virtual network, you must specify the resource group that contains it. If you do not specify a virtual network, you do not have to define this parameter.
<5> To link the new private zone to the virtual network for DNS, include `--link`. If you do not include this option, a virtual network link from the new zone to the vNet is not created.

. Repeat the previous step for each remaining legacy zone.
