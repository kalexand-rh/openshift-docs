// Module included in the following assemblies:
//
// * scalability_and_performance/using-argocd.adoc

[id="argocd-machinesets-sample_{context}"]
= MachineSets

You can use ArgoCD to deploy custom MachineSets.

.Prerequisites

* Obtain a MachineSet for your cluster.

.Procedure


. Create the `machineset` application in ArgoCD:
+
----
$ argocd app create machineset --repo https://github.com/<account_name>/openshift4-gitops.git --path=machine-sets --dest-server=https://kubernetes.default.svc --dest-namespace=openshift-machine-api
$ argocd app sync machineset
----

However there is a problem here, if you [view the yaml](./machine-sets/machinesets.yaml) you will see the cluster's generated InfraID referenced multiple times. This value is generated by the OpenShift installer and used in the naming of many cloud objects. Committing cluster config will be problematic as this value is not known before install, and not consistent across clusters.

A standard OpenShift 4 cluster with 3 compute nodes in us-east-1 comes with 6 MachineSets, one per AZ (in my account), with only three of them scaled to 1 replicas. Each MachineSet references the generated InfraID roughly 9 times:

 - MachineSet Name
 - Selector
 - IAM Instance Profile
 - Security Group Name
 - Subnet
 - AWS Tags

//TODO: Should we recommend against using MachineSets with gitops and Argo? Or is there a templating solution we should explore? In this case the value we want to template is a fact about the individual cluster it's being deployed to.
