// Module included in the following assemblies:
//
// * architecture/architecture.adoc

[id='node-management-{context}']
= Node management in fully-managed {product-title}

The fully-managed version of {product-title} version 4.0 integrates management of
the container operating system and cluster management. Because the cluster manages
both its updates and updates to RHCOS, {product-title} provides an opinionated
lifecycle management experience that simplifies the orchestration of node upgrades.

{product-title} employs three DaemonSets and controllers to simplify node management:

* The `machine-config-controller` coordinates machine upgrades.
* The `machine-config-daemon` DaemonSet is a subset of the Ingition configuration that
applies the specified machine configuration and controls kubelet configuration.
* The `machine-config-server` DaemonSet provides the Ignition config to new hosts.

These tools orchestrate operating system updates and configuration changes to
the hosts by using standard Kuberentes-style constructs. A `machine-config-daemon`
DaemonSet runs on each compute node in the cluster and watches for changes in
the machine configuration for it to apply. The machine configuration is a subset
of the Ignition configuration. The `machine-config-daemon` reads the machine configuration to see
if it needs to do an `os tree` update, if it should apply a series of `systemd`
kubelet file changes, configuration changes, or other changes to the
operating system or {product-title} configuration.

The masters also run the `machine-config-controller` process that monitors all of the cluster nodes
and orchestrates their configuration updates. So if you try to apply
an update or configuration change to a node on the cluster, the `machine-config-controller`
directs a node to update. The node sees that it needs to change, drains off its
pods, applies the update, and reboots. This process is key to the success of
managing {product-title} and RHCOS updates together.

The `machine-config-server` applies configurations to nodes as they join the
cluster. It orchestrates configuration to nodes and changes to the operating system
and is used in both cluster installation and node maintenance. The
`machine-config-server` components upgrade the operating system and controls the Ignition
configuration for nodes.

The `bootkube` process calls the `machine-config-server` component when the 
{product-title} installer bootstraps the initial master node. After installation,
the `machine-config-server` runs in the cluster.  It reads the `machine-config`
custom resource definitions (CRDs) and serves the required Ignition configurations
to new nodes when they join the cluster.
